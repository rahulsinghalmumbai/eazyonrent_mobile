<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="eazyonrent.Pages.GuesPage"
            NavigationPage.HasNavigationBar="False"
             BackgroundColor="#F8F9FA">

    <ScrollView>
        <StackLayout Padding="10" Spacing="15">

            <!-- Advertisement Section -->
            <Frame BackgroundColor="#FF6B35" 
                   CornerRadius="12" 
                   Padding="15" 
                   HasShadow="True">
                <StackLayout>
                    <Label Text="ðŸŽ‰ Special Offers!" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           TextColor="White" 
                           HorizontalOptions="Center"/>
                    <Label Text="Get 20% off on your first rental!" 
                           FontSize="14" 
                           TextColor="White" 
                           HorizontalOptions="Center"/>
                </StackLayout>
            </Frame>

            <!-- Search and Filter Section -->
            <Grid ColumnDefinitions="*, Auto" 
                  ColumnSpacing="10">

                <!-- Search Entry -->
                <Entry Grid.Column="0" 
                       x:Name="SearchEntry"
                       Placeholder="Search items..." 
                       BackgroundColor="White"
                       PlaceholderColor="#999"
                       TextColor="Black"
                       FontSize="16"
                       HeightRequest="45"/>

                <!-- Category Filter Button -->
                <Button Grid.Column="1"
                        x:Name="CategoryFilterBtn"
                        Text="ðŸ”½ Filter"
                        BackgroundColor="#007BFF"
                        TextColor="White"
                        FontSize="14"
                        CornerRadius="8"
                        WidthRequest="80"
                        HeightRequest="45"
                        Clicked="OnCategoryFilterClicked"/>
            </Grid>

            <!-- Category Filter Dropdown (Initially Hidden) -->
            <Frame x:Name="CategoryFilterLayout" 
                   IsVisible="False"
                   BackgroundColor="White"
                   CornerRadius="8"
                   HasShadow="True"
                   Padding="0">

                <CollectionView x:Name="CategoriesCollectionView"
                                ItemsSource="{Binding Categories}"
                                HeightRequest="200">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="15,10">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnCategorySelected" 
                                                          CommandParameter="{Binding .}"/>
                                </Grid.GestureRecognizers>

                                <Label Text="{Binding CategoriesName}" 
                                       FontSize="14" 
                                       TextColor="#333"
                                       VerticalOptions="Center"/>

                                <!-- Selection Indicator -->
                                <Label Text="âœ“" 
                                       FontSize="16" 
                                       TextColor="#28A745"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center"
                                       IsVisible="{Binding IsSelected}"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Frame>

            <!-- Items Collection View -->
            <CollectionView x:Name="ItemsCollectionView"
                            ItemsSource="{Binding Items}"
                            VerticalScrollBarVisibility="Never"
                            RemainingItemsThreshold="2"
                            RemainingItemsThresholdReached="OnLoadMoreItems">

                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" 
                                     Span="2" 
                                     HorizontalItemSpacing="10" 
                                     VerticalItemSpacing="15"/>
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BackgroundColor="White" 
                               CornerRadius="12" 
                               Padding="0" 
                               HasShadow="True"
                               HeightRequest="280">

                            <StackLayout Spacing="8">

                                <!-- Scrollable Image Section -->
                                <CarouselView ItemsSource="{Binding Images}" 
                                              HeightRequest="150"
                                              IndicatorView="indicatorView">
                                    <CarouselView.ItemTemplate>
                                        <DataTemplate>
                                            <Frame CornerRadius="8" Padding="0" HasShadow="False">
                                                <Image Source="{Binding .}" 
                                                       Aspect="AspectFill"
                                                       HeightRequest="150"
                                                       BackgroundColor="#F0F0F0"/>
                                            </Frame>
                                        </DataTemplate>
                                    </CarouselView.ItemTemplate>
                                </CarouselView>

                                <!-- Image Indicators -->
                                <IndicatorView x:Name="indicatorView"
                                               IndicatorColor="LightGray"
                                               SelectedIndicatorColor="#007BFF"
                                               HorizontalOptions="Center"
                                               HeightRequest="20"/>

                                <!-- Item Details -->
                                <StackLayout Padding="12,0,12,12" Spacing="4">

                                    <!-- Company Name -->
                                    <Label Text="{Binding CompanyName}" 
                                           FontSize="12" 
                                           FontAttributes="Bold" 
                                           TextColor="#007BFF"
                                           LineBreakMode="TailTruncation"/>

                                    <!-- Item Name -->
                                    <Label Text="{Binding ItemName}" 
                                           FontSize="14" 
                                           FontAttributes="Bold" 
                                           TextColor="Black"
                                           LineBreakMode="TailTruncation"/>

                                    <!-- Location -->
                                    <StackLayout Orientation="Horizontal" Spacing="4">
                                        <Label Text="ðŸ“" FontSize="12"/>
                                        <Label Text="Noida" 
                                               FontSize="12" 
                                               TextColor="#666"
                                               LineBreakMode="TailTruncation"/>
                                    </StackLayout>

                                    <!-- Price -->
                                    <Label Text="{Binding ItemCost, StringFormat='â‚¹{0}/day'}" 
                                           FontSize="14" 
                                           FontAttributes="Bold" 
                                           TextColor="#28A745"
                                           HorizontalOptions="End"/>
                                </StackLayout>
                            </StackLayout>

                            <!-- Tap Gesture -->
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnItemTapped" 
                                                      CommandParameter="{Binding .}"/>
                            </Frame.GestureRecognizers>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </StackLayout>
    </ScrollView>
</ContentPage>